/* interactive-canvas 0.1.1 | https://github.com/hui-w/interactive-canvas */(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(g){var f=this.prototype;a=true;var e=new this();a=false;for(var d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,i){return function(){var k=this._super;this._super=f[h];var j=i.apply(this,arguments);this._super=k;return j}})(d,g[d]):g[d]}function c(){if(!a&&this.init){this.init.apply(this,arguments)}}c.prototype=e;c.prototype.constructor=c;c.extend=arguments.callee;return c}})();"use strict";if(typeof window.$!=="function"){window.$=function(){var c=new Array();for(var b=0;b<arguments.length;b++){var a=arguments[b];if(typeof a=="string"){a=document.getElementById(a)}if(arguments.length==1){return a}c.push(a)}return c}}if(!String.prototype.isNumber){String.prototype.isNumber=function(){var a=/^\d+(\.\d+)?$/;return a.test(this)}}if(!Element.prototype.createChild){Element.prototype.createChild=function(a,e,f,d){var c=document.createElement(a);if(d&&this.hasChildNodes()){this.insertBefore(c,this.firstChild)}else{this.appendChild(c)}if(e){for(var b in e){c.setAttribute(b,e[b])}}if(f){c.innerHTML=f}return c}}var canvasPrototype=window.CanvasRenderingContext2D&&CanvasRenderingContext2D.prototype;if(!canvasPrototype.antiFuzzyLine){canvasPrototype.antiFuzzyLine=function(b,d,a,c){if(this.lineWidth%2==1){b-=0.5;d-=0.5;a-=0.5;c-=0.5}this.moveTo(b,d);this.lineTo(a,c)}}if(!canvasPrototype.drawStone){canvasPrototype.drawStone=function(c,b,g,d){var a=b+d;var f=g+d;this.save();this.beginPath();this.arc(a,f,d-2,0,2*Math.PI);this.closePath();var e=this.createRadialGradient(a+2,f-2,d-2,a+2,f-2,0);if(c){e.addColorStop(0,"#0A0A0A");e.addColorStop(1,"#636766")}else{e.addColorStop(0,"#999999");e.addColorStop(1,"#FFFFFF")}this.fillStyle=e;this.fill();this.restore()}}if(!canvasPrototype.roundRect){canvasPrototype.roundRect=function(a,e,b,c,d){if(b<2*d){d=b/2}if(c<2*d){d=c/2}this.beginPath();this.moveTo(a+d,e);this.arcTo(a+b,e,a+b,e+c,d);this.arcTo(a+b,e+c,a,e+c,d);this.arcTo(a,e+c,a,e,d);this.arcTo(a,e,a+b,e,d);this.closePath();return this}}if(!Array.prototype.forEach){Array.prototype.forEach=function(f){var c,b;if(this==null){throw new TypeError("this is null or not defined")}var e=Object(this);var a=e.length>>>0;if(typeof f!=="function"){throw new TypeError(f+" is not a function")}if(arguments.length>1){c=arguments[1]}b=0;while(b<a){var d;if(b in e){d=e[b];f.call(c,d,b,e)}b++}}}if(!Array.prototype.filter){Array.prototype.filter=function(c){if(this===void 0||this===null){throw new TypeError()}var f=Object(this);var a=f.length>>>0;if(typeof c!=="function"){throw new TypeError()}var e=[];var b=arguments.length>=2?arguments[1]:void 0;for(var d=0;d<a;d++){if(d in f){var g=f[d];if(c.call(b,g,d,f)){e.push(g)}}}return e}}if(typeof Object.assign!="function"){Object.assign=function(d){if(d==null){throw new TypeError("Cannot convert undefined or null to object")}d=Object(d);for(var a=1;a<arguments.length;a++){var c=arguments[a];if(c!=null){for(var b in c){if(Object.prototype.hasOwnProperty.call(c,b)){d[b]=c[b]}}}}return d}}"use strict";(function(){var a={items:null,init:function(){this.items=[]},add:function(b){this.items.push(b)},trigger:function(){var b=arguments;this.items.filter(function(c){return typeof c==="function"}).forEach(function(c){c.apply(this,b)})}};window.EventHandler=Class.extend(a)})();"use strict";(function(){var a={items:null,onAdd:null,init:function(){this.items=[];this.onAdd=new EventHandler()},add:function(b){this.items.push(b);this.onAdd.trigger(b)},filter:function(b){return this.items.filter(b)},forEach:function(b){this.items.forEach(b)}};window.List=Class.extend(a)})();"use strict";(function(){var a={left:null,top:null,width:null,height:null,id:null,parent:null,controls:null,properties:null,absLeft:null,absTop:null,onRequestPaint:null,onPositionChange:null,onSizeChange:null,onWillPaint:null,onDidPaint:null,onCapture:null,onDrag:null,onRelease:null,init:function(e,d,c,b,f){this.left=e?e:0;this.top=d?d:0;this.width=c?c:0;this.height=b?b:0;this.id=f;this.controls=new List();this.parent=null;this.properties={isEnabled:true,isVisible:true,fillStyle:null,strokeStyle:"#000",lineWidth:0};this.absLeft=null;this.absTop=null;this.onRequestPaint=new EventHandler();this.onPositionChange=new EventHandler();this.onSizeChange=new EventHandler();this.onCapture=new EventHandler();this.onDrag=new EventHandler();this.onRelease=new EventHandler();this.onWillPaint=new EventHandler();this.onDidPaint=new EventHandler();this.controls.onAdd.add(function(g){g.parent=this;g.onRequestPaint.add(function(){this.onRequestPaint.trigger()}.bind(this))}.bind(this))},updatePropValue:function(c,d,b){if(this.properties[c]===d){return false}this.properties[c]=d;if(b){this.controls.forEach(function(e){e.setProp(c,d,b)})}return true},getProp:function(b,c){if(b==null){return null}if(this.properties[b]!=null&&c!=null){return this.properties[b][c]}else{return this.properties[b]}},setProp:function(b,c){switch(b){case"isEnabled":if(this.updatePropValue("isEnabled",c,true)){this.requestPaint()}break;case"isVisible":if(this.updatePropValue("isVisible",c,true)){this.requestPaint()}break;case"fillStyle":if(this.updatePropValue("fillStyle",c)){this.requestPaint()}break;case"strokeStyle":if(this.updatePropValue("strokeStyle",c)){this.requestPaint()}break;case"lineWidth":if(this.updatePropValue("lineWidth",c)){this.requestPaint()}break}},saveContext:function(b){if(this.absLeft==null||this.absTop==null){this.absLeft=this.left;this.absTop=this.top}b.save();if(this.absLeft!==0||this.absTop!==0){b.translate(this.absLeft,this.absTop)}this.onWillPaint.trigger(b)},restoreContext:function(b){this.onDidPaint.trigger(b);b.restore();this.controls.filter(function(c){return c.getProp("isVisible")&&typeof c.paint==="function"}).forEach(function(c){c.absLeft=this.absLeft+c.left;c.absTop=this.absTop+c.top;c.paint(b)}.bind(this))},isPointInside:function(c,b){return c>=this.absLeft&&c<=this.absLeft+this.width&&b>=this.absTop&&b<=this.absTop+this.height},handleEvent:function(b,d,c){if(!this.getProp("isEnabled")||!this.getProp("isVisible")){return}if(this.isPointInside(d,c)){switch(b){case"capture":this.onCapture.trigger(d,c);break;case"drag":this.onDrag.trigger(d,c);break;case"release":this.onRelease.trigger(d,c);break}}this.controls.forEach(function(e){if(typeof e.handleEvent==="function"){e.handleEvent(b,d,c)}})},requestPaint:function(){this.onRequestPaint.trigger()},getContext:function(){var b=this;while(b!=null){if(b.context){return b.context}b=b.parent}return null},getAbsPostion:function(){var d=this.left;var c=this.top;var b=this.parent;while(b!=null){d+=b.left;c+=b.top;b=b.parent}return{left:d,top:c}},setPosition:function(c,b){if(this.left===c&&this.top===b){return}this.left=c;this.top=b;this.requestPaint();this.onPositionChange.trigger(c,b);this.controls.forEach(function(d){d.requestPaint()})},setSize:function(c,b){if(this.width===c&&this.height===b){return}this.width=c;this.height=b;this.onSizeChange.trigger(c,b);this.requestPaint()}};window.Component=Class.extend(a)})();"use strict";(function(){var a={paint:function(b,c){if(!c){this.saveContext(b)}if(this.getProp("fillStyle")!=null){b.fillStyle=this.getProp("fillStyle");b.fillRect(0,0,this.width,this.height)}if(this.getProp("strokeStyle")&&this.getProp("lineWidth")>0){b.lineWidth=this.getProp("lineWidth");b.strokeStyle=this.getProp("strokeStyle");b.strokeRect(0,0,this.width,this.height)}if(!c){this.restoreContext(b)}}};window.Panel=Component.extend(a)})();"use strict";(function(){var a={onTextChange:null,textObject:null,init:function(f,e,d,c,g,h){this._super(f,e,d,c,h);this.onTextChange=new EventHandler();this.textObject=null;var b={fontSize:12,fontFace:"Arial, Helvetica, sans-serif",fontColor:"#000000",text:g,horizontalAlign:"left",verticalAlign:"top",alignMode:"boundary"};this.properties=Object.assign({},this.properties,b);this.onSizeChange.add(function(j,i){this.updateTextObject()}.bind(this))},setProp:function(b,c){this._super(b,c);switch(b){case"horizontalAlign":if(this.updatePropValue("horizontalAlign",c)){this.updateTextObject();this.requestPaint()}break;case"verticalAlign":if(this.updatePropValue("verticalAlign",c)){this.updateTextObject();this.requestPaint()}break;case"text":if(this.updatePropValue("text",c)){this.updateTextObject();this.requestPaint();this.onTextChange.trigger()}break;case"fontColor":if(this.updatePropValue("fontColor",c)){this.requestPaint()}break;case"fontSize":if(this.updatePropValue("fontSize",c)){this.updateTextObject();this.requestPaint()}}},getTextObject:function(){if(this.textObject==null){this.updateTextObject()}return this.textObject},updateTextObject:function(e){if(!e){e=this.getContext();if(!e){return}}var d=this.getProp("text").split(/\\n/);e.save();e.font=this.getProp("fontSize")+"px "+this.getProp("fontFace");var g=parseInt(e.measureText(this.getProp("text")).width);var f=this.getProp("fontSize");var c=0,b=0;if(this.getProp("horizontalAlign")=="center"){c=parseInt(this.width/2-g/2)}else{if(this.getProp("horizontalAlign")=="right"){c=this.width-g}}if(this.getProp("verticalAlign")=="middle"){b=parseInt(this.height/2-f/2)}else{if(this.getProp("verticalAlign")=="bottom"){b=this.height-f}}this.textObject={left:c,top:b,width:g,height:f};e.restore()},paint:function(d){this.saveContext(d);this._super(d,true);d.font=this.getProp("fontSize")+"px "+this.getProp("fontFace");d.fillStyle=this.getProp("fontColor");d.textBaseline="top";var c=this.getTextObject();d.fillText(this.getProp("text"),c.left,c.top);this.restoreContext(d)}};window.Label=Panel.extend(a)})();"use strict";(function(){var a={capturedPosition:null,onTap:null,init:function(f,e,d,c,g,h){this._super(f,e,d,c,g,h);this.capturedPosition=null;this.onTap=new EventHandler();var b={isOn:false,radius:0,focusStyle:{fillStyle:"#337AB7",strokeStyle:"#337AB7",lineWidth:1,fontColor:"#fff"}};this.properties=Object.assign({},this.properties,b);this.properties.fillStyle="#FFF";this.properties.strokeStyle="#337AB7";this.properties.lineWidth=1;this.properties.fontColor="#337AB7";this.properties.horizontalAlign="center";this.properties.verticalAlign="middle";this.onCapture.add(this.handleCapture.bind(this));this.onRelease.add(this.handleRelease.bind(this));this.onDrag.add(this.handleDrag.bind(this))},paint:function(d){this.saveContext(d);if(this.capturedPosition||this.getProp("isOn")){d.fillStyle=this.getProp("focusStyle","fillStyle");d.strokeStyle=this.getProp("focusStyle","strokeStyle");d.lineWidth=this.getProp("focusStyle","lineWidth")}else{d.fillStyle=this.getProp("fillStyle");d.strokeStyle=this.getProp("strokeStyle");d.lineWidth=this.getProp("lineWidth")}if(this.getProp("radius")==0){d.beginPath();d.moveTo(0,0);d.lineTo(this.width,0);d.lineTo(this.width,this.height);d.lineTo(0,this.height);d.closePath()}else{d.roundRect(0,0,this.width,this.height,this.getProp("radius"))}d.fill();d.stroke();if(this.getProp("text")){if(this.capturedPosition||this.getProp("isOn")){d.fillStyle=this.getProp("focusStyle","fontColor")}else{d.fillStyle=this.getProp("fontColor")}d.font=this.getProp("fontSize")+"px "+this.getProp("fontFace");d.textBaseline="top";var c=this.getTextObject();d.fillText(this.getProp("text"),c.left,c.top)}this.restoreContext(d)},setProp:function(b,c){this._super(b,c);switch(b){case"isOn":if(this.updatePropValue("isOn",c)){this.requestPaint()}break;case"radius":if(this.updatePropValue("radius",c)){this.requestPaint()}break;case"focusStyle":this.properties.focusStyle=Object.assign(this.properties.focusStyle,c);this.requestPaint();break}},handleCapture:function(c,b){if(!this.isPointInside(c,b)){return}this.capturedPosition={left:c,top:b};this.requestPaint()},handleRelease:function(c,b){if(!this.capturedPosition){return}if(this.isPointInside(c,b)){this.onTap.trigger(c,b)}this.capturedPosition=null;this.requestPaint()},handleDrag:function(c,b){}};window.Button=Label.extend(a)})();"use strict";(function(){var a={isFullScreen:null,canvas:null,context:null,delayTimer:null,init:function(d,b,c){this._super(0,0,d,b);this.isFullScreen=c;this.canvas=null;this.delayTimer=null;this.onRequestPaint.add(function(){this.requestPaint()}.bind(this))},renderInto:function(c){this.canvas=c.createChild("canvas",{width:this.width,height:this.height});if(typeof G_vmlCanvasManager!="undefined"){this.canvas=G_vmlCanvasManager.initElement(this.canvas)}this.context=this.canvas.getContext("2d");this.canvas.addEventListener("mousedown",this.handleMouse.bind(this),false);this.canvas.addEventListener("mousemove",this.handleMouse.bind(this),false);this.canvas.addEventListener("mouseup",this.handleMouse.bind(this),false);this.canvas.addEventListener("touchstart",this.handleTouch.bind(this),false);this.canvas.addEventListener("touchend",this.handleTouch.bind(this),false);this.canvas.addEventListener("touchmove",this.handleTouch.bind(this),false);if(this.isFullScreen){var b=function(){var e=document.documentElement.clientWidth;var d=document.documentElement.clientHeight;if(e!=this.width||d!=this.height){this.width=e;this.height=d;this.resize()}}.bind(this);setInterval(b,200)}else{this.requestPaint()}},resize:function(){this.canvas.width=this.width;this.canvas.height=this.height;this.onSizeChange.trigger(this.width,this.height);this.requestPaint()},requestPaint:function(){if(this.delayTimer||!this.canvas){return}this.delayTimer=setTimeout(function(){this.paint(this.context);this.delayTimer=null}.bind(this),50)},paint:function(b){this.canvas.width=this.canvas.width;this.canvas.height=this.canvas.height;this.saveContext(b);if(this.getProp("fillStyle")){b.fillStyle=this.getProp("fillStyle");b.fillRect(0,0,this.width,this.height)}if(this.getProp("strokeStyle")&&this.getProp("lineWidth")>0){b.lineWidth=this.getProp("lineWidth");b.strokeStyle=this.getProp("strokeStyle");b.strokeRect(0,0,this.width,this.height)}this.restoreContext(b)},handleMouse:function(b){switch(b.type){case"mousedown":this.capture(b);break;case"mousemove":this.drag(b);break;case"mouseup":this.release(b);break}},handleTouch:function(b){b.preventDefault();switch(b.type){case"touchstart":if(b.touches.length==1){this.capture(b.targetTouches[0])}else{if(b.touches.length==2){}}break;case"touchend":if(b.changedTouches.length==1){this.release(b.changedTouches[0])}break;case"touchmove":if(b.changedTouches.length==1){this.drag(b.changedTouches[0])}else{if(b.touches.length==2){}}break}},getEventPosition:function(b){return{left:b.pageX-this.canvas.offsetLeft,top:b.pageY-this.canvas.offsetTop}},capture:function(b){var c=this.getEventPosition(b);this.dispatchEvent("capture",c.left,c.top)},drag:function(b){var c=this.getEventPosition(b);this.dispatchEvent("drag",c.left,c.top)},release:function(b){var c=this.getEventPosition(b);this.dispatchEvent("release",c.left,c.top)},dispatchEvent:function(b,d,c){this.controls.forEach(function(e){if(typeof e.handleEvent==="function"){e.handleEvent(b,d,c)}})}};window.Canvas=Component.extend(a)})();